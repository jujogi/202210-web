{"mappings":"oeAAA,IAAAA,EAAAC,EAAA,yBCAAD,EAAAC,EAAA,mDDMA,MAAMC,EAAqBC,SAASC,eAAe,eAC7CC,EAAuBF,SAASC,eAAe,iBAErD,IAAIE,EACAC,EAAO,GASXC,eAAeC,IACX,MAAMC,EARV,SAAkBC,GACd,MAAMC,EAAMC,OAAOC,SAASC,OAG5B,OAFqB,IAAIC,gBAAgBJ,GACVK,IAAIN,GAKjBO,CAAS,OAY/B,SAAuBC,GACnBd,EAAqBe,UAAY,6DAGJD,EAAWE,OAAA,OAA6C,MAMpFC,EANsFf,EAAAgB,MAAAC,GAAAA,EAAAC,KAAAN,EAAAM,KAMpE,mEACsB,2DAKzCvB,EACIkB,UAAA,mCAGsBD,EAASO,kDACDP,EAAQQ,mDACtCC,EAAUC,eAASV,EAAAW,wBAInBX,EAAIE,OAAAU,OAAA,YAgB8BV,SACnCW,EAAA7B,SAAAC,eAAA,aAEH6B,EAAA9B,SAAA+B,cAAA,OAEAD,EAAME,UAAa,mBAEnBd,EAAAe,SAAcC,IACVJ,EAAMb,WAAc,aAChBiB,SAGXhC,EAAAiC,YAAAL,GAED9B,SAAAoC,cAAA,qBACcC,iBAAA,SAAAC,IACR,QAAAA,EAAAC,OAAAC,SAAAX,EAAAY,aAAA,MAAAH,EAAAC,OAAiEG,eAhC3DC,CACA3B,EAAAE,cAGJ0B,EAAkB5C,SAAaoC,cAAY,oBAC3CC,iBAA8B,SAAAC,IAC/BlC,EAAAyC,KAAA7B,GACNS,EAAAqB,iBAAA1C,GAEQD,GAAc4C,EAAQC,mBAAAnD,EAAAoD,GAAA9C,EAAA+C,IAAA9C,GAC3BwC,EAAkBH,aAAS,YAAe,GAE1CG,EAAgBO,UAAS,sBAzCzBC,CALgB,UCrBpB/C,eAA0BiB,GACtB,MAAM+B,EAASC,EAAAC,IAAI1D,EAAAoD,GAAI,WAAY3B,GACnC,IAII,aAHsBgC,EAAAE,OAAOH,IACRI,OAGvB,MAAMnB,GACJoB,QAAQC,IAAIrB,IDWGsB,CAAWrD,GAI1Be,GAAIf,yBAmENV,EAAAgE,MAAAxD,MAAAyD,IACAA,GAQF3D,EAAc2D,EAEb1D,QAAA2C,EAAAgB,gBAAAlE,EAAAoD,GAAA9C,EAAA+C","sources":["src/scripts/product.js","src/scripts/functions/getProduct.js"],"sourcesContent":["import { db, auth } from \"./app\";\r\nimport { onAuthStateChanged } from \"firebase/auth\";\r\nimport { getProduct } from \"./functions/getProduct\";\r\nimport { getFirebaseCart, createFirebaseCart } from \"./functions/cart\";\r\nimport { getMyLocalCart, addProductToCart, currencyFormat } from \"../utils\";\r\n\r\nconst productInfoSection = document.getElementById(\"productInfo\");\r\nconst productAssetsSection = document.getElementById(\"productAssets\");\r\n\r\nlet userLogged = undefined;\r\nlet cart = [];\r\n\r\nfunction getParam(param) {\r\n    const url = window.location.search;\r\n    const searchParams = new URLSearchParams(url);\r\n    const productId = searchParams.get(param);\r\n    return productId;\r\n}\r\n\r\nasync function loadProduct() {\r\n    const productId = getParam(\"id\"); // http://localhost:1234/product.html?id=TXQ9Wf1GIoAOJLkIEMYo&age=20\r\n\r\n    const data = await getProduct(productId);\r\n\r\n    const product = {\r\n        ...data,\r\n        id: productId, // docSnap.id,\r\n    }\r\n\r\n    renderProduct(product);\r\n}\r\n\r\nfunction renderProduct(product) {\r\n    productAssetsSection.innerHTML = `\r\n    <img class=\"product__mainImage\" id=\"mainImage\" src=\"${product.images[0]}\">`;\r\n\r\n    const isProductAddedToCart = cart.some((productCart) => productCart.id === product.id);\r\n\r\n    const productButtonCart = isProductAddedToCart ?\r\n    '<button class=\"product__cart\" disabled>Producto añadido</button>' :\r\n    '<button class=\"product__cart\">Añadir al carrito</button>';\r\n\r\n    productInfoSection.innerHTML = `\r\n    <h1 class=\"product__name\">${product.name}</h1>\r\n    <p class=\"product__description\">${product.description}</p>\r\n    <h3 class=\"product__price\">${currencyFormat(product.price)}</h3>\r\n    ${productButtonCart}`;\r\n\r\n    if (product.images.length > 1) {\r\n        createGallery(product.images);\r\n    }\r\n\r\n    const productCartButton = document.querySelector(\".product__cart\");\r\n    productCartButton.addEventListener(\"click\", e => {\r\n        cart.push(product);\r\n\r\n        addProductToCart(cart);\r\n\r\n        if (userLogged) {\r\n            createFirebaseCart(db, userLogged.uid, cart);\r\n        }\r\n\r\n        productCartButton.setAttribute(\"disabled\", true);\r\n        productCartButton.innerText = \"Producto añadido\";\r\n    });\r\n}\r\n\r\nfunction createGallery(images) {\r\n    const mainImage = document.getElementById(\"mainImage\");\r\n\r\n    const gallery = document.createElement(\"div\");\r\n    gallery.className = \"product__gallery\";\r\n\r\n    images.forEach(image => {\r\n        gallery.innerHTML += `<img src=\"${image}\">`;\r\n    });\r\n\r\n    productAssetsSection.appendChild(gallery);\r\n\r\n    const galleryImages = document.querySelector(\".product__gallery\");\r\n\r\n    galleryImages.addEventListener(\"click\", e => {\r\n        if (e.target.tagName === \"IMG\") {\r\n            mainImage.setAttribute(\"src\", e.target.currentSrc);\r\n        }\r\n    });\r\n}\r\n\r\nonAuthStateChanged(auth, async (user) => {\r\n    if (user) {\r\n      // User is signed in, see docs for a list of available properties\r\n      // https://firebase.google.com/docs/reference/js/firebase.User\r\n      userLogged = user;\r\n      cart = await getFirebaseCart(db, userLogged.uid);\r\n      console.log(cart);\r\n      // ...\r\n    } else {\r\n        cart = getMyLocalCart();\r\n      // User is signed out\r\n      // ...\r\n    }\r\n\r\n    loadProduct();\r\n\r\n  });","import { db } from \"../app\";\r\nimport { doc, getDoc } from \"firebase/firestore\";\r\n\r\nasync function getProduct(id) {\r\n    const docRef = doc(db, \"products\", id);\r\n    try {\r\n        const docSnap = await getDoc(docRef);\r\n        const data = docSnap.data();\r\n    \r\n        return data; \r\n    } catch(e) {\r\n        console.log(e);\r\n    }\r\n}\r\n\r\nexport {\r\n    getProduct\r\n}"],"names":["$li1Mx","parcelRequire","$63445bb05f51f6f7$var$productInfoSection","document","getElementById","$63445bb05f51f6f7$var$productAssetsSection","$63445bb05f51f6f7$var$userLogged","$63445bb05f51f6f7$var$cart","async","$63445bb05f51f6f7$var$loadProduct","productId","param","url","window","location","search","URLSearchParams","get","$63445bb05f51f6f7$var$getParam","product","innerHTML","images","productButtonCart","some","productCart","id","name","description","$2EF88","currencyFormat","price","length","mainImage","gallery","createElement","className","forEach","image","appendChild","querySelector","addEventListener","e","target","tagName","setAttribute","currentSrc","$63445bb05f51f6f7$var$createGallery","productCartButton","push","addProductToCart","$hMt9z","createFirebaseCart","db","uid","innerText","$63445bb05f51f6f7$var$renderProduct","docRef","$etBjH","doc","getDoc","data","console","log","$96d763eed7c24a29$export$e2005c9600188ac7","auth","user","getFirebaseCart"],"version":3,"file":"product.cc70c22b.js.map"}