{"mappings":"oeAAA,IAAAA,EAAAC,EAAA,sBCAAC,EAAAD,EAAA,uCDMA,MAAME,EAAiBC,SAASC,eAAe,YACzCC,EAAiBF,SAASC,eAAe,YACzCE,EAAcH,SAASC,eAAe,SAE5C,IAAIG,EACAC,EAAW,GACXC,EAAO,GAEXC,eAAeC,IACX,MAAMC,QCbVF,eAA2BG,GACvB,MAAMC,EAAgBb,EAAAc,WAAWF,EAAI,YACrC,IACI,MALRG,KAKgBA,SAAgBf,EAAAgB,QAAQH,GAOhC,OANiBE,EAAKE,KAAKC,IAChB,IACAA,EAAIC,OACPC,GAAIF,EAAIE,OAIlB,MAAMC,GACJC,QAAQC,IAAIF,IDCeG,CAAY1B,EAAAc,IAC3CX,EAAewB,UAAY,GAC3Bd,EAAiBe,SAAQC,IACrBC,EAAcD,MAGlBpB,EAAWI,EAGf,SAASiB,EAAcC,GACnB,MAAMF,EAAUzB,SAAS4B,cAAc,KACvCH,EAAQI,UAAY,UAEpBJ,EAAQK,aAAa,OAAQ,qBAAqBH,EAAKT,MAEvD,MAAMa,EAAaJ,EAAKK,OAASL,EAAKK,OAAO,GAAK,8EAI5CC,EAFuB3B,EAAK4B,MAAMC,GAAgBA,EAAYjB,KAAOS,EAAKT,KAGhF,mEAAkE,2DAGjEO,EAAOF,UAAY,mBAUpBQ,4GAImCJ,EAAAS,oDACXT,EAAAU,iDAEfC,EAASC,eAAEZ,EAAAa,wBAChBP,wBAO8BQ,YAAAhB,SAE/BiB,EAAAjB,EAAAkB,cAAA,kBACND,EAAAE,iBAAA,SAAArC,MAAAY,IAEDA,EAAS0B,iBACLvC,EAAoBwC,KAAAnB,GACpBW,EAAMS,iBAAWzC,GAEbF,SAAsB4C,EAAAC,mBAAArD,EAAAc,GAAAN,EAAA8C,IAAA5C,GAEtBoC,EAAkBZ,aAClB,YAAmB,GAA+DY,EAAAS,UAAA,+BAMZC,IAG1E,MAAIC,EAAanD,EACMoD,MAAmDC,EAAApD,EAAAmD,MAG1E,IAAAE,EAAA,GACwBA,EAAP,KAAjBH,EAAoChD,EAAAoD,QAAAhC,GAAAA,EAAAW,WAAAiB,IAEjChD,EAEN,QAAAkD,IAAAC,EAAAA,EAAAE,MAAA,CAAAC,EAAAC,IAAAA,EAAApB,MAAAmB,EAAAnB,SAGG,SAAAe,IAAAC,EAAWA,EAAAE,MAAA,CAAAC,EAAAC,IAAAD,EAAAnB,MAAAoB,EAAApB,SAGfzC,EAAYwB,UAAiB,GACzBiC,EAAAhC,SAAAC,IACDC,EAAAD,QAIGmB,iBAAA,UAAAzB,aAGIyB,iBAAS,UAAAzB,IACbiC,SAOFS,mBAAAjE,EAAAkE,MAAAvD,MAAAwD,IAECA","sources":["src/scripts/shop.js","src/scripts/functions/products.js"],"sourcesContent":["import { db, auth } from \"./app\";\r\nimport { onAuthStateChanged } from \"firebase/auth\";\r\nimport { getProducts } from \"./functions/products\";\r\nimport { createFirebaseCart, getFirebaseCart  } from \"./functions/cart\";\r\nimport { addProductToCart, getMyLocalCart, currencyFormat } from \"../utils\";\r\n\r\nconst productSection = document.getElementById(\"products\");\r\nconst categoryFilter = document.getElementById(\"category\");\r\nconst orderFilter = document.getElementById(\"order\");\r\n\r\nlet userLogged = undefined;\r\nlet products = [];\r\nlet cart = [];\r\n\r\nasync function loadProducts() {\r\n    const firebaseProducts = await getProducts(db);\r\n    productSection.innerHTML = \"\";\r\n    firebaseProducts.forEach(product => {\r\n        renderProduct(product);\r\n    });\r\n\r\n    products = firebaseProducts;\r\n}\r\n\r\nfunction renderProduct(item) {\r\n    const product = document.createElement(\"a\");\r\n    product.className = \"product\";\r\n\r\n    product.setAttribute(\"href\", `./product.html?id=${item.id}`);\r\n\r\n    const coverImage = item.images ? item.images[0] : \"https://cdn1.iconfinder.com/data/icons/business-company-1/500/image-512.png\";\r\n\r\n    const isProductAddedToCart = cart.some((productCart) => productCart.id === item.id);\r\n\r\n    const productButtonCart = isProductAddedToCart ?\r\n    '<button class=\"product__cart\" disabled>Producto añadido</button>' :\r\n    '<button class=\"product__cart\">Añadir al carrito</button>';\r\n\r\n    product.innerHTML = `\r\n    <img src=\"${coverImage}\" alt=\"\" class=\"product__image\">\r\n    <div class=\"product__info\">\r\n        <p class=\"product__category\">${item.category}</p> \r\n        <h2 class=\"product__name\">${item.name}</h2>\r\n        <h3 class=\"product__price\">${currencyFormat(item.price)}</h3>\r\n        ${productButtonCart}\r\n    </div>\r\n    `;\r\n\r\n    productSection.appendChild(product);\r\n\r\n    const productCartButton = product.querySelector(\".product__cart\");\r\n\r\n    productCartButton.addEventListener(\"click\", async (e) => {\r\n        e.preventDefault(); // evitar que al dar click en el boton, funcione el enlace del padre.\r\n\r\n        cart.push(item);\r\n        addProductToCart(cart);\r\n\r\n        if (userLogged) {\r\n            await createFirebaseCart(db, userLogged.uid, cart);\r\n        }\r\n\r\n        productCartButton.setAttribute(\"disabled\", true);\r\n        productCartButton.innerText = \"Producto añadido\";\r\n\r\n    });\r\n}\r\n\r\nfunction filterBy(){\r\n    const newCategory = categoryFilter.value;\r\n    const newOrder = orderFilter.value;\r\n\r\n    let filteredProducts = [];\r\n\r\n    if (newCategory !== \"\") {\r\n        filteredProducts = products.filter((product) => product.category === newCategory);\r\n    } else {\r\n        filteredProducts = products;\r\n    }\r\n\r\n    if (newOrder === \"asc\") {\r\n        filteredProducts = filteredProducts.sort((a, b) => b.price - a.price);\r\n    }\r\n\r\n    if (newOrder === \"desc\") {\r\n        filteredProducts = filteredProducts.sort((a, b) => a.price - b.price);\r\n    }\r\n    \r\n    productSection.innerHTML = \"\";\r\n    filteredProducts.forEach(product => {\r\n        renderProduct(product);\r\n    });\r\n\r\n}\r\n\r\ncategoryFilter.addEventListener(\"change\", e => {\r\n    filterBy();\r\n});\r\n\r\norderFilter.addEventListener(\"change\", e => {\r\n    filterBy();\r\n});\r\n\r\nonAuthStateChanged(auth, async (user) => {\r\n    if (user) {\r\n      // User is signed in, see docs for a list of available properties\r\n      // https://firebase.google.com/docs/reference/js/firebase.User\r\n      userLogged = user;\r\n      cart = await getFirebaseCart(db, userLogged.uid);\r\n      // ...\r\n    } else {\r\n        cart = getMyLocalCart();\r\n      // User is signed out\r\n      // ...\r\n    }\r\n\r\n    loadProducts();\r\n\r\n  });\r\n","import { collection, getDocs } from \"firebase/firestore\";\r\n\r\nasync function getProducts(db) {\r\n    const collectionRef = collection(db, \"products\");\r\n    try {\r\n        const { docs } =  await getDocs(collectionRef);\r\n        const products = docs.map((doc) => {\r\n            return {\r\n                ...doc.data(),\r\n                id: doc.id,\r\n            };\r\n        });\r\n        return products;\r\n    } catch(e) {\r\n        console.log(e);\r\n    }\r\n}\r\n\r\nexport {\r\n    getProducts,\r\n}"],"names":["$li1Mx","parcelRequire","$etBjH","$a9cddcee321f50ec$var$productSection","document","getElementById","$a9cddcee321f50ec$var$categoryFilter","$a9cddcee321f50ec$var$orderFilter","$a9cddcee321f50ec$var$userLogged","$a9cddcee321f50ec$var$products","$a9cddcee321f50ec$var$cart","async","$a9cddcee321f50ec$var$loadProducts","firebaseProducts","db","collectionRef","collection","docs","getDocs","map","doc","data","id","e","console","log","$3f21a7ce0033bb95$export$68a801b7b3c0bfaa","innerHTML","forEach","product","$a9cddcee321f50ec$var$renderProduct","item","createElement","className","setAttribute","coverImage","images","productButtonCart","some","productCart","category","name","$2EF88","currencyFormat","price","appendChild","productCartButton","querySelector","addEventListener","preventDefault","push","addProductToCart","$hMt9z","createFirebaseCart","uid","innerText","$a9cddcee321f50ec$var$filterBy","newCategory","value","newOrder","filteredProducts","filter","sort","a","b","onAuthStateChanged","auth","user"],"version":3,"file":"shop.7855240a.js.map"}